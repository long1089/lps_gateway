@model Dictionary<string, int>
@{
    ViewData["Title"] = "审计统计";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-bar-chart"></i> 审计统计</h1>
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> 返回列表
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">最近30天操作统计</h5>
        
        @if (Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>操作类型</th>
                            <th>次数</th>
                            <th>比例</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var total = Model.Values.Sum();
                        }
                        @foreach (var item in Model.OrderByDescending(x => x.Value))
                        {
                            var percentage = total > 0 ? (double)item.Value / total * 100 : 0;
                            <tr>
                                <td>
                                    <span class="badge bg-@GetActionBadgeColor(item.Key)">
                                        @item.Key
                                    </span>
                                </td>
                                <td>@item.Value</td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" 
                                             style="width: @percentage%" 
                                             aria-valuenow="@percentage" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                            @percentage.ToString("F1")%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>总计</th>
                            <th>@total</th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }
        else
        {
            <p class="text-muted text-center mb-0">暂无统计数据</p>
        }
    </div>
</div>

@functions {
    private string GetActionBadgeColor(string action)
    {
        return action switch
        {
            "Login" => "success",
            "Logout" => "secondary",
            "Create" => "primary",
            "Update" => "info",
            "Delete" => "danger",
            "Download" => "warning",
            "Upload" => "warning",
            _ => "secondary"
        };
    }
}
